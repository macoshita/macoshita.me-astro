---
title: ドメインを Cloudflare に移管したメモ
createdAt: 2024-02-15 22:00:00 +09:00
tags: [Cloudflare]
layout: "@/layouts/BlogPostLayout.astro"
---

元々このブログのドメインは Cloudflare で買ったものなのと、他のドメインで運用してるサイトも単なる静的ページなので、Cloudflare Pages にしたいというのもあり、持ってるドメインのレジストラを Cloudflare にまとめた。
その際に若干だけどハマりがあったので、そのメモ。
なお移管元はお名前.com だけど、多分どこから移管する場合もあまり関係ない。

## 前提

前提として、Cloudflare でカスタムネームサーバーを使うには Business プランにアップグレードする必要がある。
つまり無料で運用するにはネームサーバーも Cloudflare に移行する必要がある。

## ネームサーバー移行

ドメインを移管するだけ、という気持ちで Cloudflare の管理画面を探ると「以下の手順に従って〜」という形でヘルプを案内される。
そのリンクのアンカーが <https://developers.cloudflare.com/registrar/get-started/transfer-domain-to-cloudflare/> の真ん中あたりを指しているんだけどこれが罠で、 **上記のページは最初から読まないと駄目。**
（以下は自分のメモなので、上記ページを頭から読んでやったほうがいいと思う。）

上記ページを最初から読めばわかるが、まず最初に **移管するドメイン用のサイトを作る** 必要がある。管理画面左上のこちらから、

![cloudflare](/public/images/2024-02-15-cloudflare.png)

サイトを追加を選ぶと、ドメインを入力する画面が出てくるので、移管するドメインを入力。

![Alt text](/public/images/2024-02-15-add-domain.png)

そしてあとは画面に従って Cloudflare のネームサーバーを移管元のレジストラの管理画面に登録する。
そうすると DNS レコードをいい感じに設定した状態になり、まずネームサーバーの移行が完了する。
最初に移管したドメインは、上記ドキュメントを途中から読んで半端なことをしたせいで、この DNS レコードの自動設定がうまく動かず面倒なことになった。

ここまでで、 Cloudflare 管理画面で、左のメニューからドメイン登録→ドメイン移管を選択すると、移管できるドメインがあると表示されるので、それを確認してから次へ。

## Whois 情報代行を切る

お名前.com の自分の設定では、Whois 情報代行を切れば移管準備は完了のようだった。
Whois 代行を切ったら早めに移管したほうがいいので、Cloudflare の管理画面で「移管できる」と出てから切った方が良い。
他にも DNSSEC を切るとか色々やることがある場合があるので、くどいようだが上記ドキュメントを読むのが良い。

## ドメイン移管

Cloudflare 管理画面のドメイン移管で、移管したいドメインを選ぶ。
移管元から AuthCode を取得して入力しろと出るので、レジストラの管理画面から AuthCode を取得して進める。

お名前.com の場合はしばらくするとメールで移管を許可するためのリンクが送られてくるので、そのリンクにアクセスして許可する。
以上で完了。

## まとめ

わかってからはすごく簡単だった。
改めてアンカーなしの URL を貼っておく。

<https://developers.cloudflare.com/registrar/get-started/transfer-domain-to-cloudflare/>